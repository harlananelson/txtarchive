name: Compliance Scan

on: [push, pull_request]

jobs:
  scan-for-sensitive-data:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Scan for forbidden terms
        run: |
          # 1. Define the forbidden term in Base64 (Obfuscated)
          # "aXVoZWFsdGg=" decodes to the forbidden company name
          ENCODED_TERM="aXVoZWFsdGg="
          
          # 2. Decode it at runtime only
          FORBIDDEN=$(echo "$ENCODED_TERM" | base64 --decode)
          
          echo "Scanning codebase for forbidden terms..."
          
          # 3. Run grep
          # -r: recursive
          # -I: ignore binary files
          # --exclude-dir=.git: ignore git history
          # --exclude="compliance-scan.yaml": ignore this file (just in case)
          
          if grep -rnI --exclude-dir=.git "$FORBIDDEN" .; then
              echo "❌ FAILURE: Forbidden company data found in the files listed above."
              exit 1
          else
              echo "✅ SUCCESS: No forbidden terms found."
              exit 0
          fi